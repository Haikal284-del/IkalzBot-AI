
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>IkalzBot - AI Chat</title>
    <style>
        body {
            overflow: hidden;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #watermark{
            position: absolute;
            font-family: Sans-Serif;
            font-size: 8px;
            color: white;
            text-shadow: 2px 2px 2px black;
            left: 68%;
            top: 0px;
        }
        #up {
            position: fixed;
            width: 99.2%;
            height: 65px;
            border: 2px solid;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #6dd5ed);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        #ppWa {
            position: absolute;
            width: 13.5%;
            height: 80%;
            border: 2px solid black;
            border-radius: 100px;
            top: 8%;
            left: 7%;
            background-color: silver;
            overflow: auto;
        }
        #kepala {
            position: absolute;
            border: 2px solid black;
            border-radius: 50px;
            width: 40%;
            height: 40%;
            top: 20%;
            left: 50%;
            transform: translate(-50%);
            background-color: white;
        }
        #badan {
            position: absolute;
            border: 2px solid black;
            left: 50%;
            transform: translate(-50%);
            top: 67%;
            width: 80%;
            background-color: white;
            height: 50%;
            border-radius: 100px;
        }
        #nicknameWa {
            position: absolute;
            left: 23%;
            top: -15%;
            color: white;
            font-size: 16px;
        }
        #status {
            position: absolute;
            left: 23%;
            top: 48%;
            color: white;
            font-size: 9px;
        }
        #down {
            position: absolute;
            width: 99.2%;
            height: 60px;
            border: 2px solid black;
            background-color: black;
            top: 91.3%;
        }
        #kirimPesan {
            position: absolute;
            width: 80%;
            border: 2px solid black;
            background-color: white;
            height: 45px;
            top: 10%;
            border-radius: 100px;
            left: 1%;
        }
        #send {
            position: absolute;
            width: 15%;
            height: 85%;
            border: 2px solid black;
            border-radius: 100px;
            background-color: green;
            top: 10%;
            left: 83%;
            color: white;
            font-size: 28px;
            text-align: center;
        }
        #pesanText {
            position: absolute;
            width: 100%;
            height: 20%;
            border: none;
            border-radius: 100px;
            font-size: 25px;
            text-align: left;
            padding: 22px;
        }
        #isi {
            position: absolute;
            width: 99.2%;
            height: 81.9%;
            border: 2px solid black;
            top: 9%;
        }
        #Messages {
            position: absolute;
            overflow-y: auto;
            scroll-behavior: smooth;
            overflow-wrap: break-word;
            word-wrap: break-word;      
            white-space: normal;       
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #fffbf3;
        }
        #end{
            position: absolute;
            width: 80%;
            height: %;
            border: 2px solid black;
            background-color: #ffdb99;
            text-align: center;
            font-size: 12px;
            left: 50%;
            transform: translate(-50%);
            color: #636363;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298, #6dd5ed);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white;
            padding: 15px 20px;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            fill: white;
            cursor: pointer;
        }

        .header h1 {
            margin: 0;
            
        }

        .contacts {
            padding: 20px 10px;
            overflow-y: auto;
            height: calc(100vh - 85px);
            font-size: 40px;
        }

        .contact {
            padding: 10px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 25px;
        }

        .contact:hover {
            background-color: #f2f2f2;
        }

        .profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 15px;
        }

        .contact .name {
            position: absolute;
            top: 9%;
            font-weight: bold;
            flex: 10;
            left: 22%;
            font-size: 22px;
        }

        .footer {
            position: absolute;
            background-color: purple;
            padding: 10px 17px;
            text-align: center;
            
            bottom: 0;
            left: 0;
            width: 350px;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
        }

        .footer a {
            color: white;
            text-decoration: none;
            flex: 1;
            padding: 5px 0;
            font-size: 20px;
        }

        /* Menu Box */
        .menu-box {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: #fff;
            box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease-in-out;
            z-index: 101;
            padding: 20px;
            border-left: 2px solid #128C7E;
            transform: translateX(100%);
        }

        .menu-content {
            padding: 20px 0;
        }

        .menu-content a {
            display: block;
            margin-bottom: 10px;
            text-decoration: none;
            color: #333;
            font-weight: bold;
            font-size: 16px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f2f2f2;
            transition: background-color 0.3s;
        }

        .menu-content a:hover {
            background-color: #e0e0e0;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .close-btn svg {
            fill: #666;
            width: 100%;
            height: 100%;
        }
        #response-container {
    position: relative;
    width: 90%; /* Sesuaikan dengan kebutuhan */
    max-height: 400px; /* Batasi tinggi maksimal */
    overflow: auto; /* Tambahkan scroll jika konten melebihi batas */
    border: 2px solid black;
    border-radius: 10px;
    background-color: #fff; /* Warna latar belakang */
    padding: 10px; /* Ruang dalam */
    word-wrap: break-word; /* Membungkus teks panjang */
}
        #ppWa2 {
            position: absolute;
            width: 14.25%;
            height: 7.5%;
            border: 2px solid black;
            border-radius: 100px;
            top: 8%;
            left: 5%;
            background-color: silver;
            overflow: auto;
        }
        #kepala2 {
            position: absolute;
            border: 2px solid black;
            border-radius: 50px;
            width: 40%;
            height: 40%;
            top: 20%;
            left: 50%;
            transform: translate(-50%);
            background-color: white;
        }
        #badan2 {
            position: absolute;
            border: 2px solid black;
            left: 50%;
            transform: translate(-50%);
            top: 110%;
            width: 200%;
            background-color: white;
            height: 130%;
            border-radius: 100px;
        }
        #statusId2{
            color: green;
            font-size: 14px;
            position: absolute;
            top: 13%;
            font-weight: bold;
            flex: 10;
            left: 22%;
        }
        #waktuChat{
            color: black;
            font-size: 12px;
            position: absolute;
            top: 14%;
            font-weight: bold;
            flex: 10;
            left: 86%;
        }
        #textWa{
            font-size: 20px;
        }
        #chatRoom{
            display: none;
        }
        #loby{
            display: block;
            width: 100%;
        }
        #backToloby{
            top: -10px;
            position: absolute;
            font-size: 35px;
            background-color: transparent;
            left: -25px;
            color: white;
            border: 1px solid transparent;
            z-index: 99;
            width: 80px;
            text-shadow: 5px 2px 2px #777;
        }
        .chat-message img {
    border: 2px solid #ddd;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            
        }
        .centang{
            color: black;
        }
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
iframe, #response-container {
    max-width: 100%; /* Membatasi lebar */
    max-height: 100%; /* Membatasi tinggi */
    overflow: auto; /* Menambahkan scroll jika perlu */
}

    </style>
</head>
<body>
<div id="chatRoom">
    <div id="app">
        <div id="up">
            <div id="watermark">
                <h2>©Made By Vikalz-Dev</h2>
            </div>
            <button id="backToloby" onclick="backLoby()"type="submit">←</button>
            <div id="ppWa">
                <div id="kepala"></div>
                <div id="badan"></div>
            </div>
            <div id="nicknameWa">
                <h2 id="Name">IkalzBot</h2>
            </div>
            <div id="status">
                <h2 id="statusId">Online</h2>
            </div>
            
        </div>
        <div id="isi">
            <div id="Messages">
                <h2 id="end">Selamat datang, Terimakasih telah menggunakan IkalzBot, Untuk melihat semua fitur yang tersedia , Minta sama bot nya ya. Btw jangan salah gunakan bot ini ya. Follow akun tiktok @Vikalz.dev</h2></div>
            <div id="loadingAnimation" style="display: none; position: absolute; border: 2px solid black; border-radius: 10px; width: auto; max-width: 60%; height: auto; background-color: #fff; font-size: 16px; align-self: flex-start; top: 0; padding: 5px;">
            <div style="display: flex; align-items: center;">
            <div class="spinner" style="width: 10px; height: 10px; border: 5px solid #ccc; border-top: 5px solid #128C7E; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 5px;"></div>
            <span id="txtLoading">Membuat gambar.</span>
            </div>
            </div>
            
        </div>
        <div id="down">
            <div id="kirimPesan">
                <input type="text" name="pesanText" id="pesanText" value="" placeholder="Ketik pesan"  />
            </div>
            <button id="send" onclick="sendChat()">></button>
        </div>
    </div>

    <script type="text/javascript" charset="utf-8">
    function backLoby(){
        document.getElementById('loby').style.display = "block"
        document.getElementById('chatRoom').style.display = "none"
    }
    let pesanTerbaru = "Online";
let pesanDari = "";
    let borderclrBot="black";
        let awalan = false;
            var textChat = "";
            var temW = 0;
            var gHeight = 0;
            var level = 20;
            var date;
            var chatLoby = "";
            let idCentang=1;
        function sendChat() {
            date = new Date();
    if (document.getElementById('pesanText').value === "") {
        alert("Isi dulu pesannya sayang😪");
        return;
    }

    if (!tugas) {
        tugas = true;
        
        textChat = document.getElementById('pesanText').value;
        var messageContainer = document.getElementById('Messages');
        var lastMessage = messageContainer.lastChild;
        var lastMessageHeight = lastMessage ? lastMessage.clientHeight : 0;

        // Validasi level
        if (isNaN(level)) {
            level = 80; // Reset ke nilai awal
        }

        level += lastMessageHeight + 10; // Tambahkan jarak antar pesan
        date = new Date();
        // Tambahkan pesan baru
        messageContainer.innerHTML += `
            <div class="chat-message" style="position:absolute;border:2px solid black; border-radius:10px;width:auto;max-width:70%;height:auto;background-color:#c0ff73;top:${level}px;justify-content: flex-end;font-size:${ukuranFont}px; align-self: flex-end;">
                ${textChat}
                <div style="display: flex; justify-content: flex-end; align-items: center; font-size: 14px; margin-top: 5px;">
                    <span style="margin-right: 5px;">
                        ${date.getHours()}.${date.getMinutes()}
                    </span>
                    <div id="centang${idCentang}" style="font-size: 14px;">✓</div>
                </div>
            </div>`;
        document.getElementById('pesanText').value = "";
        pesanTerbaru=textChat;
        pesanDari="Anda: "
        // Scroll otomatis ke bawah
        messageContainer.scrollTop = messageContainer.scrollHeight;
        
        // Panggil fungsi untuk merespons pesan
        respondToMessage(textChat);
    } else {
        alert("Sabar dikit napa, satu satu lah😤");
    }
}
        let txtHasil = "";
        let id = 0;
            var sendBot = 0;
            var responsed = "";
            var tunggu = 0;
            let data = {
                pesan: []
            }
            let dataSave = {}
        function backLoby(){
            document.getElementById('chatRoom').style.display="none";
            document.getElementById('loby').style.display="block";
        }
        // fungsi generator image :
        // Tambahkan ke bagian fungsi
        function generateCode(txtPrompt,jelasCode){
            
            showLoadingAnimationCode(txtPrompt,jelasCode);
            
        }
        
        let timestamp="";
        async function generateImg(txt) {
            // Ambil prompt dari input
            showLoadingAnimation();
            const prompt = txt;
             timestamp = Date.now(); // ID unik berdasarkan waktu
            // Endpoint untuk Pollinations Text Description
            const textEndpoint = `https://text.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
            
            // Fetch deskripsi dari API Pollinations
            let description;
            try {
                const textResponse = await fetch(textEndpoint);
                description = responsed;
                
            } catch (error) {
                
                console.error('Error fetching text:', error);
                return;
            }

            // Endpoint untuk Pollinations Image
            const imageEndpoint = `https://image.pollinations.ai/prompt/${encodeURIComponent(description)}`;
            
            // Fetch gambar dari API Pollinations
            try {
                
                const imageResponse = await fetch(imageEndpoint);
                const imageBlob = await imageResponse.blob();
                const imageURL = URL.createObjectURL(imageBlob);
                const imageContainer = document.getElementById('Messages');
                var messageContainer = document.getElementById('Messages');
                var lastMessage = messageContainer.lastChild;
                var lastMessageHeight = lastMessage ? lastMessage.clientHeight: 0;
                let data = new Date();
                responsed=txtHasil;
                tunggu=true;
                pesanTerbaru="Membuat gambar...";
                pesanDari="";
                responsBot(showImg)
                level += lastMessageHeight + 30;
                const imageElement = `
                <div id="image-${timestamp}" class="chat-message" style="position:absolute;border:2px solid black; border-radius:10px;width:auto;max-width:60%;height:auto;background-color:black;top:${level}px;justify-content: flex-start;font-size:20px; align-self: flex-start;">
                <a href="${imageURL}">
                <img src="${imageURL}" alt="${txt}" style="max-width:98%;border-radius:10px;"/>
                </a>
                <a href="${imageURL}" download="IkalzBot-img${"_"+Math.floor(Math.random()*9500+500)+data.getYear()+data.getHours()+data.getMinutes()+".jpg"}"style="position: relative;border:2px solid #aaa; background-color: green;color:white;width:50%;height:40px;font-size:18px;left:35%;">Simpan</a>
                
                
                
            </div>`;
            menggambar=false;
            hideLoadingAnimation();
            pesanTerbaru="Foto."
             pesanDari=""
        level += 10; // Menambahkan tinggi pesan (atur sesuai kebutuhan)
        console.log(level)
        imageContainer.innerHTML += imageElement;
        imageContainer.scrollTop = imageContainer.scrollHeight;
                
                
                
            } catch (error) {
                hideLoadingAnimation();
                console.error('Error fetching image:', error);
            }
        }
        function gantiImg(id) {
    const imageElement = document.getElementById(`image-${id}`);
    const responseElement = document.getElementById(`response-${id}`);

    if (imageElement) imageElement.remove();
    if (responseElement) responseElement.remove();
    level=tempLevel;
    level+=20;
    // Tampilkan status memproses ulang gambar
    document.getElementById('statusId').innerHTML = "Membuat gambar.";

    // Proses ulang gambar menggunakan prompt terakhir
    if (promptForImg) {
        generateImg(`${promptForImg} || Id prompt: ${Math.floor(Math.random()*9999999999)}.`); // Bisa disesuaikan jika prompt spesifik dibutuhkan
    } else {
        console.error("Prompt gambar tidak ditemukan.");
    }
}
        function lihatImg(url){
            window.location.href=url;
        }
        function simpanFoto(url){
            const a = document.createElement('a');
    a.href = url;
    a.download = 'IkalzBot-Img-Tes.jpg'; // Nama file untuk download
    a.style.display = 'none';
    
    // Tambahkan elemen ke dokumen dan klik otomatis
    document.body.appendChild(a);
    
        }
        let tugas = false;
        let bgChatBot="#fff"
        let prompts = "";
        let newChat = "";
        let fiturBot = ["Generate Image : ketika client meminta untuk membuatkan sebuah gambar,kamu akan memberikan sebuah prompt untuk membuat gambar itu,hanya prompt untuk gambar itu.","Code generate : ketika user meminta buatkan suatu kode pemograman,maka kamu langsung akan memberikan kode nya saja ,tidak ada penjelaskan tambahan ,hanya kode. langsung ke element pertama tanpa menggunakan petik tiga,kamu akan membuatkan kode selengkap mungkin layaknya seperti ahli pembuat kode,dan semua logika nya lengkap kamu buatkan jika di perlukan,dan atur lah posisi kode nya dengan rapi,tambahkan \n untuk turun ke bawah."]
        function upPrompt(){
            let idPrompt = Math.floor(Math.random()*9999999999);
            prompts = `Hai ai, kamu adalah assisten saya sekarang,kamu akan merespon pesan saya se baik mungkin,kamu selalu ramah ,
                nama kamu adalah IkalzBot,penciptakamu adalah HaikalDev.

                
                
                kamu harus mengingat riwayat pesan ini.
                
                id prompt : ${idPrompt}.
                
                Berikut adalah pesan terbaru dari client : ${newChat}.
                
                berikut fitur yang dapat kamu lakukan : ${fiturBot}
                oke mulai lah sekarang,langsung respon pesan client nya sekarang!! jangan sampai lupa!!
                berikut riwayat pesan kita :
                ${data.pesan}.
                obrolan ini berkelanjutan,jadi kamu hanya perlu melanjutkan obrolan nya.
                respon tanpa sapaan hai/halo lagi jika user tidak menyapa.
                Respon :`
        }
        let read="false";
        let txtRead="black";
        let clrChatBot="black";
        let showImg = "";
        let ukuranFont=16;
        let menggambar=false;
        let promptForImg = "";
        let ngoding=false;
        function showLoadingAnimationCode(txtPrompt,jelasCode) {
    const loadingElement = document.getElementById('loadingAnimation');
    document.querySelector("#txtLoading").innerHTML="Sedang Ngoding."
    const messageContainer = document.getElementById('Messages');
    var messageContainers = document.getElementById('Messages');
                var lastMessage = messageContainers.lastChild;
                var lastMessageHeight = lastMessage ? lastMessage.clientHeight: 0;
                
                
    // Posisi animasi
    loadingElement.style.top = `${level+lastMessageHeight+20}px`;
    loadingElement.style.display = 'block';
    messageContainer.appendChild(loadingElement);
    messageContainer.scrollTop = messageContainer.scrollHeight;
    level+=lastMessageHeight-20;
     pesanTerbaru="Mengetik...";
                pesanDari="";
    setTimeout(function(){
        hideLoadingAnimationCode();
        responsed=jelasCode;
        responsBot();
        
        level+=lastMessageHeight-20;
        
        setTimeout(function(){
        ngoding=true;
        document.getElementById('statusId').innerHTML="Mengetik...";
         pesanTerbaru="Mengetik...";
                pesanDari="";
        ukuranFont=16;
        bgChatBot="black";
        clrChatBot="white";
        borderclrBot="green";
        responsed=txtPrompt;
        responsBot();
        
        
    },2000)
    },5000)
}

let tempLevel=80;
        function showLoadingAnimation() {
    const loadingElement = document.getElementById('loadingAnimation');
    const messageContainer = document.getElementById('Messages');
    var messageContainers = document.getElementById('Messages');
                var lastMessage = messageContainers.lastChild;
                var lastMessageHeight = lastMessage ? lastMessage.clientHeight: 0;
                
                
    // Posisi animasi
    loadingElement.style.top = `${level+lastMessageHeight+20}px`;
    loadingElement.style.display = 'block';
    messageContainer.appendChild(loadingElement);
    messageContainer.scrollTop = messageContainer.scrollHeight;
    level+=lastMessageHeight-50;
}
function hideLoadingAnimation() {
    const loadingElement = document.getElementById('loadingAnimation');
    loadingElement.style.display = 'none';
}
        
function hideLoadingAnimationCode() {
    const loadingElement = document.getElementById('loadingAnimation');
    loadingElement.style.display = 'none';
}

function chatDuluan(){
    let random1=Math.floor(Math.random()*9999999999);
    let random2=Math.floor(Math.random()*9999999999);
    let random3=Math.floor(Math.random()*9999999999);
    txt=`IdPrompt1: ${random1},IdPrompt2: ${random2},IdPrompt3: ${random3}. || Hai ai,chat lah dia duluan kepada user saya,berikan selamat datang di Web IkalzBot,singkat dan pendek saja,chat dia sekarang!`;
    let urltoPrompt = "https://text.pollinations.ai/prompt/"+txt; // URL yang ingin diambil
                
                fetch(urltoPrompt)
                
                .then(response => response.text()) // Mengambil teks dari URL
                .then(data => {
                    level=20;
                     pesanTerbaru="Mengetik...";
                pesanDari="";
                    document.getElementById('statusId').innerHTML="Mengetik...";
                    responsed=data;
                    responsBot();
                })
    
}

        function respondToMessage(message) {
            
                id++;
                if (message.includes("#link")){
                    
                }else{
                data.pesan.push(`User: ${textChat}`)
                }
                newChat = data.pesan[data.pesan.length-1]
                
                upPrompt();
                if (data.pesan.length > 10) {
                    data.pesan = [];
                }
                if (message.toLowerCase().includes("#link")) {
                    
  // Ambil link setelah "#cekLink"
  let link = message.slice(message.indexOf("#link") + 5).trim();

  // Minta user memasukkan nama file
  let ids=Math.floor(Math.random()*9999);
  let filenamed = `WebId_${ids}`;

  // Validasi input
  if (!link || !filenamed) {
    alert("Link atau nama file tidak boleh kosong!");
    return;
  }

  // Panggil fungsi cekLink (pastikan cekLink sudah async)
  cekLink(link, filenamed)
    .then(() => {
      document.getElementById("statusId").innerHTML="Membuka Tautan...";
      cekLinks=true;
      document.getElementById(`centang`+idCentang).innerHTML="✓✓";
      document.getElementById(`centang`+idCentang).style.color="blue";
      idCentang++;
    })
    .catch((error) => {
      alert(`Terjadi kesalahan: ${error.message}`);
    });
}else if(message.toLowerCase().includes("#musik")){
    document.getElementById(`centang`+idCentang).innerHTML="✓✓";
    document.getElementById(`centang`+idCentang).style.color="blue";
      idCentang++;
    let lyric = message.slice(message.indexOf("#musik") + 6).trim();
    document.getElementById("txtLoading").innerHTML=`Mencari ${lyric}...`;
    document.getElementById("statusId").innerHTML=`Sedang mencari...`;
    document.querySelector(".spinner").style.borderTop="5px solid red";
    showLoadingAnimation();
    setTimeout(function(){
        hideLoadingAnimation();
        searchAndSendMusic(lyric);
    },5000)
    
    }else{
                const url = "https://text.pollinations.ai/prompt/"+prompts; // URL yang ingin diambil
                
                fetch(url)
                
                .then(response => response.text()) // Mengambil teks dari URL
                .then(dataPrompt => {
                    
                    document.getElementById(`centang`+idCentang).innerHTML="✓✓";
                    promptForImg=dataPrompt;
                    console.log("Prompt : "+promptForImg)
                    setTimeout(function() {
                        
                        setTimeout(function() {
                            responsed = dataPrompt;
                            
                            let cekImg = textChat;
                            if (cekImg.includes("gambar")||cekImg.includes("Gambar")||cekImg.includes("foto")||cekImg.includes("Foto")||cekImg.includes("ilustriasi")||cekImg.includes("Gambarkan")||cekImg.includes("Gambarlah")) {
                        tempLevel=level;
                                responsed+=" #image";
                                if (responsed.includes("#image")) {
                       
                        let isi = promptForImg;
                        data.pesan.push(`Respon: ${isi} (Prompt gambarnya)`);
                        document.querySelector(".spinner").style.borderTop="5px solid blue";
                        document.getElementById('statusId').innerHTML="Membuat gambar...";
                        menggambar=true;
                        newChat=`responlah pesan ini untuk menunjukan bahwa gambarnya telah di hasilkan,contohnya seperti : ini adalah gambar [permintaan user] yang anda butuhkan ,jangan gunakan tanda (") pada kalimatnya.buatlah lah kalimat untuk penunjukan gambarnya di atas. berikut permintaan dari client : ${textChat}`;
                        const urls = "https://text.pollinations.ai/prompt/"+newChat;
                        fetch(urls).then(response => response.text()).then(isiData => {
                        txtHasil=isiData;
                        isi+=".hilangkan watermark.";
                        
                        generateImg(isi);
                        })
                        
                        
                        }
                            }else if (cekImg.includes("Buat")&&cekImg.includes("code")||cekImg.includes("Buatkan")&&cekImg.includes("code")||cekImg.includes("Berikan")&&cekImg.includes("website")||cekImg.includes("Buatkan")&&cekImg.includes("web")||cekImg.includes("Buatkan")&&cekImg.includes("kode")||cekImg.includes("kode")&&cekImg.includes("Berikan")||cekImg.includes("Berikan")&&cekImg.includes("web")) {
                           responsed+=" #coding";
                                if (responsed.includes("#coding")) {
                        let isi = responsed;
                        document.querySelector(".spinner").style.borderTop="5px solid green";
                        document.getElementById('statusId').innerHTML="Sedang ngoding...";
                        
                        newChat=`responlah pesan ini untuk menunjukan bahwa kode pemogramannya telah di hasilkan,contohnya seperti : berikut adalah kode yang anda perlukan untuk membuat website sekolah anda,jangan gunakan tanda (") pada kalimatnya.buatlah lah kalimat untuk penunjukan kodenya di atas. kamu hanya memberikan kalimat yang menunjukan kode nya di bawah,kamu tidak perlu memberikan kode lagi karena kode nya sudah dibuat. berikut permintaan dari client : ${textChat}`;
                        const urls = "https://text.pollinations.ai/prompt/"+newChat;
                        fetch(urls).then(response => response.text()).then(jelasCode => {
                        txtHasil=jelasCode;
                        
                        
                        generateCode(dataPrompt,jelasCode)
                        })
                        
                        
                        }
                            
                       }else{
                            pesanTerbaru="Mengetik...";
                pesanDari="";
                             document.getElementById('statusId').innerHTML="Mengetik...";
                             responsBot(data);
                            }
                            
                             // Menampilkan data di elemen div
                            //fitur :
                            
                       
                        },Math.floor(Math.random()*3000));
                        read=true;
                        document.getElementById(`centang`+idCentang).style.color="blue";
                        document.getElementById('statusId').innerHTML="Online";
                        idCentang++;
                    }, Math.floor(Math.random()*3000+500))
                    cekLinks=false;
                },Math.floor(Math.random()*3000+1500))
                .catch(error => {
                    setTimeout(function() {
                         pesanTerbaru="Mengetik...";
                pesanDari="";
                        responsed=`Jaringan lu error nih, lu ada kouta kan?, Error code : ${error}`;
                        responsBot();
                    }, 1500)
                    cekLinks=false;
                });
    }
            }
            let wdBot="60%"
            let cekLinks=false;
            function displayWebContent(htmlContent) {
                let messageContainer = document.getElementById("Messages");
        let lastMessage = messageContainer.lastChild;
let lastMessageHeight = lastMessage ? lastMessage.clientHeight : 0;
level+=lastMessageHeight+20;
    const container = document.createElement("div");
    container.id = `response-${timestamp}`;
    container.className = "chat-message";
    container.style = `
        position: absolute;
        border: 2px solid black;
        border-radius: 20px;
        width: 70%;
        max-width: 70%;
        height: 800px;
        background-color: #fff;
        top: ${level}px;
        justify-content: flex-start;
        font-size: 16px;
        align-self: flex-start;
        white-space: pre-wrap;
        overflow: hidden;
    `;
    pesanTerbaru="Website."
     pesanDari=""
    const iframe = document.createElement("iframe");
    iframe.style = `
        width: 100%;
        height: 800px; /* Atur tinggi */
        border: none;
        overflow: auto;
    `;
    iframe.srcdoc = htmlContent; // Masukkan isi HTML ke dalam iframe

    container.appendChild(iframe);
    document.getElementById("Messages").appendChild(container);

    // Tunggu hingga elemen dirender
    setTimeout(() => {
         messageContainer = document.getElementById("Messages");
         lastMessage = messageContainer.lastChild;
 lastMessageHeight = lastMessage ? lastMessage.clientHeight : 0;
        
         
        document.getElementById("Messages").scrollTop = document.getElementById("Messages").scrollHeight;
    }, 0);
    tugas=false;
}
        async function cekLink(link, filenamed) {
    const url = link;

    if (!url || !filenamed) {
        alert("Link atau nama file tidak boleh kosong!");
        return;
    }
    
    try {
        const response = await fetch('http://localhost:8080/save-html', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ url, filename: filenamed }),
        });

        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.error || "Gagal mengambil data dari URL.");
        }
        const htmlContent = data.dataCode;

        // Tampilkan isi web
        displayWebContent(htmlContent);

        // Tambahkan tombol unduh
        
         pesanTerbaru="Mengetik...";
                pesanDari="";
        responsed=`Ini adalah tampilan web dari ${url}.`;
        responsBot();
    } catch (error) {
        alert(`Error: ${error.message}`);
    }
}
function downloadFile(htmlContent,filenamed){
    downloadFiles(htmlContent,filenamed)
}
function downloadFiles(htmlContent,filenamed) {
    // Membuat elemen <a>
    const link = document.createElement('a');
    
    // Menetapkan atribut href ke elemen <a>
    link.href = `data:text/html;charset=utf-8,${encodeURIComponent(htmlContent)}" download="${filenamed}.html`;
    
    // Menambahkan atribut target agar terbuka di tab baru (opsional)
    link.target = '_blank'; 
    link.download;
    // Menyembunyikan elemen <a>
    link.style.display = 'none';
    
    // Menambahkan elemen ke dokumen
    document.body.appendChild(link);
    
    // Melakukan klik otomatis
    link.click();
    
    // Menghapus elemen setelah klik
    document.body.removeChild(link);
}

// Contoh penggunaan

        function responsBot(chat) {
    setTimeout(function () {
        var messageContainer = document.getElementById('Messages');
        var lastMessage = messageContainer.lastChild;
        var lastMessageHeight = lastMessage ? lastMessage.clientHeight : 0;
        level += lastMessageHeight + 10; // Add spacing between messages

        function escapeHTML(text) {
            if (cekLinks == false) {
                return text
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            } else {
                return text;
            }
        }

        // Tambahkan pesan ke dalam container
        var timestamp = Date.now(); // Gunakan timestamp unik untuk setiap pesan
        messageContainer.innerHTML +=
            '<div id="response-' + timestamp + '" class="chat-message" style="position:absolute;border:2px solid ' + borderclrBot + '; border-radius:10px;width:auto;max-width:' + wdBot + ';height:auto;background-color:' + bgChatBot + ';top:' +
            level +
            'px;justify-content: flex-start;font-size:' + ukuranFont + 'px; align-self: flex-start;white-space: pre-wrap;color: ' + clrChatBot + ';">' +
            escapeHTML(responsed) +
            '<div id="tools-' + timestamp + '" style="display:none;"></div>' + // Tempat untuk tombol salin
            '<div style="font-size:12px; text-align:right;">' +
            date.getHours() +
            "." +
            date.getMinutes() +
            '</div></div>';
            
            if(responsed.length>8){
                pesanTerbaru=`${responsed.slice(0,30)}...`;
            }else{
                pesanTerbaru=responsed;
            }
             pesanDari=""
        // Logika untuk menampilkan tombol salin jika ngoding == true
        if (ngoding == true) {
            var toolsElement = document.getElementById("tools-" + timestamp);
            toolsElement.style = `
                position: relative;
                width: 100%;
                height: 35px;
                text-align: center;
                font-size: 25px;
                background-color: black;
                border: 2px solid #aaa;
                color: white;
                margin-top: 5px;
                cursor: pointer;
                left:0%;
            `;
            toolsElement.innerHTML = "Salin";
            toolsElement.style.display = "block"; // Tampilkan tombol salin

            // Tambahkan event listener untuk tombol salin
            toolsElement.addEventListener("click", function () {
                navigator.clipboard.writeText(responsed).then(() => {
                    alert("Teks berhasil disalin!");
                }).catch(err => {
                    alert("Gagal menyalin teks: " + err);
                });
            });
        }

        // Scroll otomatis ke bawah
        messageContainer.scrollTop = messageContainer.scrollHeight;

        // Reset variabel dan status bot
        sendBot = 0;
        document.getElementById('statusId').innerHTML = "Online";
        sendBot = 1;
        pbc = false;
        tunggu = 0;
        ukuranFont = 16;
        bgChatBot = "#fff";
        clrChatBot = "black";
        borderclrBot = "black";
        tugas = false;
        ngoding = false;

        // Tambahkan pesan ke log data jika bukan perintah link
        if (!textChat.includes("#link")) {
            data.pesan.push(`Respon: ${responsed}`);
        }
        console.log(data.pesan);

        // Perbarui status terakhir dilihat
        setTimeout(function () {
            let data = new Date();
            document.getElementById('statusId').innerHTML = `Terakhir dilihat ${data.getHours()}.${data.getMinutes()}`;
        }, Math.floor(Math.random() * 3000 + 2500));
    }, 2000);
}
        function kataLanjutan(kata) {
            setTimeout(function(){
                tunggu=0;
            var messageContainer = document.getElementById('Messages');
            var lastMessage = messageContainer.lastChild;
            var lastMessageHeight = lastMessage ? lastMessage.clientHeight: 0;
            level += lastMessageHeight + 10; // Add spacing between messages

            messageContainer.innerHTML +=
            '<div class="chat-message" style="position:absolute;border:2px solid black; border-radius:20px;width:auto;max-width:70%;height:auto;background-color:#fff;top:' +
            level +
            'px;justify-content: flex-start;font-size:'+ukuranFont+'px; align-self: flex-start;">' +
            kata +
            '<div style="font-size:30px; text-align:right;color: #fff;">' +
            date.getHours() +
            "." +
            date.getMinutes() +
            '</div></div>';

            // Automatically scroll down
            messageContainer.scrollTop = messageContainer.scrollHeight;
            document.getElementById('statusId').innerHTML="Online";
            },2000)
        }
        setInterval(function(){
            if(read==true){
                txtRead="blue";
            }else{
                txtRead="black";
            }
        })
        
        // Fitur Lainnya :
        // Fungsi untuk mengunduh video menggunakan API Snaptik
        
        // Fitur musikApi
         

// Tambahkan fungsi ini ke tombol atau trigger
let musikId=1;
async function searchAndSendMusic(query) {
    if (!query) {
        alert("Masukkan kata kunci untuk mencari musik.");
        return;
    }

    try {
        const response = await fetch(`http://localhost:3000/api/search?query=${query}`);
        const data = await response.json();
        responsed=`Berikut hasil pencarian dari ${query}.`
        responsBot();
        if (data.length > 0) {
            setTimeout(function(){
                const messageContainer = document.getElementById('Messages');
            const lastMessage = messageContainer.lastChild;
            const lastMessageHeight = lastMessage ? lastMessage.clientHeight : 0;
            level += lastMessageHeight + 10;

            data.forEach((track) => {
                messageContainer.innerHTML +=
            '<div id="response-'+timestamp+'" class="chat-message" style="position:absolute;border:3px solid '+borderclrBot+'; border-radius:20px;width:100%;max-width:'+wdBot+';height:auto;background-color:'+bgChatBot+';top:' +
            level +
            'px;justify-content: flex-start;font-size:'+ukuranFont+'px; align-self: flex-start;white-space: pre-wrap;color: '+clrChatBot+';">'+
            "<br/>Judul Musik: "+track.title+"<br/> Artist: "+track.artist+"<br/> <audio controls style='width: 100%;'> <source style='width:100%;border: 3px solid blue;height:100px;background-color:green;color:white;'src="+track.preview+" type='audio/mpeg'> Browser Anda tidak mendukung elemen audio. </audio>"+
            '<div style="font-size:30px; text-align:right;">' +
            date.getHours() +
            "." +
            date.getMinutes() +
            '</div></div><p/><p/><p/><p/>';
                musikId++;
                if(musikId<3){
                    musikId++;
                }else{
                    musikId=1;
                }
                level += 220; // Tambahkan jarak vertikal untuk pesan berikutnya
            });
            
            messageContainer.scrollTop = messageContainer.scrollHeight; // Scroll ke bawah otomatis
            },2000)
            
        } else {
            responsed="Tidak ada hasil musik ditemukan untuk pencarian ini.";
            responsBot();
        }
    } catch (error) {
        responsed="Error saat mencari musik:"+ error;
        responsBot();
    }
}

// Tambahkan fungsi ini ke tombol atau trigger
function handleMusicSearch() {
    const query = prompt("Masukkan kata kunci musik:");
    if (query) {
        searchAndSendMusic(query);
    }
}
    </script>
</div>
<div id="loby">
    <div class="header">
        <h1 id="textWa">IkalzBot</h1>
        <button id="refresh" type="submit"onclick="segarkan()"style="border 2px solid black; background-color: red;color: white;">Refresh</button>
    </div>

    <div class="contacts"onclick="buka()">
        <div class="contact">
            <div id="ppWa2"><div id="kepala2">
                <div id="badan2">
                    
                </div>
            </div></div>
            <div class="name">IkalzBot</div>
            <div id="statusId2">Online</div>
            <div id="waktuChat"></div>
        </div >
        <!-- Add more contacts here -->
    </div>

    <div class="footer">
        <a href="#"onclick="infoApp()">Info</a>
        <a href="#"onclick="SosmedUs()">Kontak</a>
        <a href="#"onclick="LaporBug()">Bug</a>
    </div>

    <!-- Menu Box -->
    

    <script>
    var date = new Date();
    document.getElementById('waktuChat').innerHTML=date.getHours()+'.'+date.getMinutes();
        function toggleMenu() {
            
            var menuBox = document.getElementById("menuBox");
            if (menuBox.style.left === "0%") {
                menuBox.style.left ="100%";
            } else {
                menuBox.style.left = "0%";
            }
        }

        function infoApp() {
            alert("Hello User!! \n Terimakasih telah menggunakan aplikasi IkalzBot ini, Kami mohon maaf jika respon dari bot nya Error/ngebug. \n Aplikasi ini dibuat dengan pemograman Html, css, javascript dan nodejs. \n \n Kami mohon untuk tidak menyalahgunakan aplikasi ini untuk hal negatif,kami tidak bertanggung jawab atas apapun.\n \n Informasi Aplikasi: \n Nama Aplikasi: IkalzBot \n Versi Aplikasi: 1.7 \n Website: https://IkalzBot-ChatAI.github.com/haikaldel-263/ \n Made by: HaikalDev \n Powered: Javascript \n \n Terimakasih telah membaca.harap patuhi syarat dan ketentuan aplikasi ini.");
        }

        function SosmedUs() {
            alert("Ikuti kami di Sosial media!! \n \n Tiktok: @Vikalz.dev \n  Youtube: @VikalzDev \n  Facebook: @VikalzDev \n \n NB: Akun asli ada cap gajah nya :v");
        }
        function LaporBug(){
            alert("Laporkan Bug!! \n \n Ikuti step berikut: \n 1.Masukan nama kamu \n 2.Masukan Bug yang di alami \n 3.Masukan Alasan melaporkan Bug.");
            let nama = prompt("Masukan nama kamu :");
            let BugType = prompt("Masukan Bug yang di alami :");
            let alasan = prompt("Alasan Melaporkan Bug :");
            if(nama&&BugType&&alasan){
            alert("Kamu akan diarahkan ke WhatsApp Admin Aplikasi IkalzBot!! \n \n Tekan Kirim saat sudah di chat.")
            window.location.href=`https://wa.me/+6283111486366?text=Laporan Bug Aplikasi IkalzBot!!, Nama pengirim: ${nama}, Bug yang ditemukan: ${BugType}, Alasan Melaporkan Bug: ${alasan}.`
            }else{
                alert("Gagal Melaporkan Bug, Lengkapi pertanyaan tadi dulu.")
            }
        }
        
        let chatDulu=false;
        function buka(){
            setTimeout(function(){
                document.getElementById('loby').style.display="none";
                document.getElementById('chatRoom').style.display="block";
                if(chatDulu==false){
                    chatDuluan();
                    chatDulu=true;
                }
            })
        }
        function segarkan(){
            window.location.reload();
        }
        setInterval(function(){
            document.getElementById("statusId2").innerHTML=`${pesanDari}${pesanTerbaru}`
            
        })
    </script>
    </div>
    <script type="text/javascript" charset="utf-8">
        var pbc=false;
        if(document.getElementById('loby').style.display=="block"){
            if(tunggu==1){
                document.getElementById('statusId2').innerHTML="Mengetik..."; 
            }
            if(pbc==true){
                document.getElementById('statusId2').innerHTML="contoh pesan";
            }
        }
    </script>
</body>
</html>